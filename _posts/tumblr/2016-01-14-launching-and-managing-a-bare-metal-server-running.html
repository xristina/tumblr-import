---
layout: post
title: Launching and managing a bare metal server running Docker in a few minutes
date: '2016-01-14T07:28:01+02:00'
tags:
- packet
- bare metal
- cloud management
- monitoring
tumblr_url: https://blog.mist.io/post/135389284061/launching-and-managing-a-bare-metal-server-running
---
<p>In 2014, we saw Docker bursting into the infrastructure world, disrupting everything in its path. While almost every cloud provider is now offering Docker-related features, it seems the prefered weapon of choice in 2015 was the combination of Docker and bare metal servers. Meanwhile, according to this year’s <a href="http://superuser.openstack.org/articles/openstack-users-share-how-their-deployments-stack-up">OpenStack Superuser survey</a>, Docker is the fourth most used “hypervisor” in OpenStack. Rob Whiteley&rsquo;s, VP of Marketing at Hedvig, anticipates that Docker <a href="http://www.hedviginc.com/blog/four-predictions-for-openstack-in-2016">will become the #2 hypervisor</a> in OpenStack in 2016.<b><br/></b></p><p>Given the right tools, launching and managing a bare metal server with Docker can be accomplished in minutes. In this example, we’ll launch a new bare metal server from <a href="https://www.packet.net">Packet</a> with Docker, secure our Docker instance with TLS authentication and manage and monitor all of them via the Mist.io interface. You will need an account with Packet and either an account on the Mist.io <a href="https://mist.io">SaaS version</a> or to install the <a href="https://github.com/mistio/mist.io">open-source version</a>.The same instructions can be applied for any provider though, not just Packet. If you’re on another provider, you can check the documentation on <a href="http://docs.mist.io/category/75-adding-your-infrastructure">how to add them</a> to Mist.io.</p><p>Why did we choose Packet? We loved the speed and agility they provide when it comes to bare metal servers. They provide dedicated servers on demand, in 6 minutes or less. Their platform brings the price and performance benefits of dedicated servers to the cloud, so it seemed ideal for our use case. If you don’t have a Packet account, you can sign up through our <a href="https://www.packet.net/promo/mistio/">partnership page</a> and get $100 in usage credit to check it out. </p><p>Now, let’s see how easy it is to launch a new bare metal with Docker through Mist.io. First, we need to add Packet as a cloud provider:</p><figure data-orig-width="1219" data-orig-height="793" class="tmblr-full"><img src="https://66.media.tumblr.com/e9304f32ea8e55f02eac667814dae35a/tumblr_inline_nzi1g7spdU1rgqrs8_540.png" alt="image" data-orig-width="1219" data-orig-height="793"/></figure><p><br/><b></b>Once you provide your API key and optionally a Project name, you should see your Packet machines along the rest of your infrastructure neatly tagged for easy access.</p><figure data-orig-width="914" data-orig-height="647" class="tmblr-full"><img src="https://66.media.tumblr.com/fb0e5c4df91936949eae097525d48a82/tumblr_inline_nzi1gwZQFJ1rgqrs8_540.png" alt="image" data-orig-width="914" data-orig-height="647"/></figure><p><br/><b></b>Time to provision your new machine and install Docker in one go. Just choose your favorite OS (in this case we went with Debian 8) and size and in the Script section, paste the script from <a href="https://get.docker.com/">get.docker.com</a>. Click on Launch and Packet will have the bare metal server ready for you within minutes.</p><figure data-orig-width="1232" data-orig-height="1011" class="tmblr-full"><img src="https://66.media.tumblr.com/e08d390f737ba167a80c140d3418ac94/tumblr_inline_nzii29MrHd1rgqrs8_540.png" alt="image" data-orig-width="1232" data-orig-height="1011"/></figure><p><br/><b></b>As with all the infrastructure managed through Mist.io, you can choose to enable monitoring, set rules and alerts in order to orchestrate your Packet machines. Once the server is ready, you can click on the shell button to open the web shell and test your Docker instance by writing:</p><pre><code>docker run hello-world</code></pre><figure data-orig-width="964" data-orig-height="695" class="tmblr-full"><img src="https://66.media.tumblr.com/9c76f9cbf45f30d6d41b18ae6f43bd04/tumblr_inline_nziixqnpvU1rgqrs8_540.png" alt="image" data-orig-width="964" data-orig-height="695"/></figure><p><br/>That’s it. Within a few minutes, a new bare metal server with Docker is up and running on Packet’s infrastructure.<br/></p><p>

But you can also use Mist.io to manage our Docker containers along your Packet bare metal server and the rest of your infrastructure. To do that, you must launch Docker in a way that can be remotely managed. To protect your Docker instance from being accessed by third parties, we will enable TLS authentication. You will need to write down the server’s IP address, that can be found inside the Basic Info panel:

<br/></p><figure data-orig-width="1226" data-orig-height="200" class="tmblr-full"><img src="https://66.media.tumblr.com/c24706bae63810a247c3b7f4f09f5ca5/tumblr_inline_o0xtsxIL901rgqrs8_540.png" alt="image" data-orig-width="1226" data-orig-height="200"/></figure><p>In this instance the IP is 147.75.174.165.<b><br/></b></p><p>The following commands will generate a certificate and the keys required, and allow Mist.io to connect to it. Substitute the SERVER_IP with your server’s address:</p><pre><code>openssl genrsa -aes256 -out ca-key.pem 4096
openssl req -new -x509 -days 365 -key ca-key.pem -sha256 -out ca.pem
openssl genrsa -out server-key.pem 4096
openssl req -subj "/CN=SERVER_IP" -sha256 -new -key server-key.pem -out server.csr
echo subjectAltName = IP:127.0.0.1,DNS:mist.io &gt; extfile.cnf
openssl x509 -req -days 365 -sha256 -in server.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out server-cert.pem -extfile extfile.cnf
openssl genrsa -out key.pem 4096
openssl req -subj '/CN=client' -new -key key.pem -out client.csr
echo extendedKeyUsage = clientAuth &gt; extfile.cnf
openssl x509 -req -days 365 -sha256 -in client.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out cert.pem -extfile extfile.cnf</code></pre><p>That’s it. Now let’s clean up a bit by deleting unneeded files and restricting access to the rest:</p><pre><code>rm -v client.csr server.csr
chmod -v 0400 ca-key.pem key.pem server-key.pem</code></pre><p>Once you’re done, start Docker by running:</p><pre><code>docker daemon --tlsverify --tlscacert=ca.pem --tlscert=server-cert.pem --tlskey=server-key.pem -H=0.0.0.0:2376</code></pre><p>Download the key.pem, cert.pem and ca.pem to your device and at the Mist.io home page, click on Add Cloud. Fill in the server’s IP, the port that the Docker daemon is listening to (in this case 2376), add the certificates and click on Add.</p><figure data-orig-width="1247" data-orig-height="837" class="tmblr-full"><img src="https://66.media.tumblr.com/81ca29685209cd7e7b7c1c67e8e0b08c/tumblr_inline_o0xtus8zk41rgqrs8_540.png" alt="image" data-orig-width="1247" data-orig-height="837"/></figure><p><b><br/></b>That’s it. Docker is up and running. You can now launch new containers in seconds through the Mist.io UI and enable monitoring and automation. Since we just installed the Docker engine, we’ll need to pull some images to use for our containers. To pull a Debian image from Mist.io’s Docker repository, you can run:</p>
<pre><code>docker pull mist/debian-wheezy</code></pre>
<p>And then back to Mist.io, go to Machines and launch the Create Machine wizard:</p><figure data-orig-width="1242" data-orig-height="1032" class="tmblr-full"><img src="https://66.media.tumblr.com/805cb58f4d1206531fa42f4e7eb871d2/tumblr_inline_o0xtveUsN71rgqrs8_540.png" alt="image" data-orig-width="1242" data-orig-height="1032"/></figure><p>Choose Debian Wheezy as your OS and click on Launch. That’s it. Your new container is ready to use!</p><figure data-orig-width="1237" data-orig-height="368" class="tmblr-full"><img src="https://66.media.tumblr.com/526d63a0e769aefb1880b1c62ffbeb73/tumblr_inline_o0xtvvUatz1rgqrs8_540.png" alt="image" data-orig-width="1237" data-orig-height="368"/></figure>
