---
layout: post
title: A review of Microsoft Azure’s API
date: '2014-12-04T17:37:00+02:00'
tags:
- API
- azure
- cloud computing
tumblr_url: https://blog.mist.io/post/104331766626/a-review-of-microsoft-azures-api
---
<p>In the last months, Microsoft has made the headlines for putting its (enormous) weight behind its Cloud business, Microsoft Azure. Between cut prices and feature enhancements, Microsoft has managed to gain significant share in the cloud provider market. <a href="http://www.microsoft.com/bizspark/">Microsoft BizSpark</a> is also an excellent startup program that gives you access to many software development tools. More importantly, you get 150$/month on Azure credit to spend the way you like, providing some crucial breathing space for early startups.</p>
<p><img alt="image" src="https://66.media.tumblr.com/a842bef0a2f31da8f291b41cde835bd2/tumblr_inline_ng2e9eSmo81rgqrs8.jpg"/></p>
<p>As we were working to <a href="http://blog.mist.io/post/103543949091/announcing-support-for-microsoft-azure">add support for Azure</a> in Mist.io, we had to deal with the API. A few weeks ago, we <a href="http://blog.mist.io/post/99488119976/first-look-at-digital-oceans-new-api">published a review</a> of Digital Ocean’s new API. While it is still in beta, we were pleasantly surprised as it solved many issues and shortcomings apparent in the first version.</p>
<p>And while we were also pleasantly surprised by Azure’s speed, features and pricing, we found that the API was not in par with the rest of the Azure framework.</p>
<p><strong>Authenticating with the API</strong></p>
<p>Unlike most modern APIs that allow you to authenticate through oAuth, Azure’s API requires your subscription ID and a pem file. That pem file, needs to be produced via openssl or IIS and then uploaded to the Azure portal. Thats a lot of hoops to jump just to authenticate with an API.</p>
<p><strong>Listing your Virtual Machines</strong></p>
<p>When you log in to your Azure portal, you get a list of all your Virtual Machines. Τo get the same list through the API, you may need to make several calls. You first need to call “list cloud services”, and for each of the cloud services you have enabled, you need to call “list deployments” to get a list of all your VMs. Be prepared to make those calls in parallel, otherwise you’ll be waiting for a long time to get a list of all your VMs.</p>
<p><strong>Creating a new VM</strong></p>
<p>Creating a new VM through the API can also become a bit complicated. If the VM you want to create is your first VM in that cloud service, you need to run “create deployment” which will also create your VM. For your next VMs though, you must call on “add role”. Even if MS needs to make that distinction internally due to their architecture, there is no reason to expose that distinction to the API.</p>
<p><strong>Performing actions on your machine</strong></p>
<p>In most providers, you can perform more or less four actions on a VM: Start, stop, reboot and destroy. The same goes for Azure, although for some reason, you have to call “operations in roles” to reboot and destroy a machine, but to start or stop it, you have to call “operations on virtual machines”.</p>
<p>To reboot a machine you need a POST call to:</p>
<pre><code><a href="https://management.core.windows.net/">https://management.core.windows.net/</a>&lt;subscription-id&gt;/services/hostedservices/&lt;cloudservice-name&gt;/deploymentslots/&lt;deployment-slot&gt;/roleinstances/&lt;role-instance-name&gt;?comp=reboot</code></pre>
<p>with Request Body: None</p>
<p>But to start a machine, you need a POST call to:</p>
<pre><code><a href="https://management.core.windows.net/">https://management.core.windows.net/</a>&lt;subscription-id&gt;/services/hostedservices/&lt;service-name&gt;/deployments/&lt;deployment-name&gt;/roleinstances/&lt;role-name&gt;/Operations</code></pre>
<p>with Request Body:</p>
<pre><code>&lt;StartRoleOperation xmlns="http://schemas.microsoft.com/windowsazure" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"&gt;
 &lt;OperationType&gt;StartRoleOperation&lt;/OperationType&gt;
&lt;/StartRoleOperation&gt;</code></pre>
<p>It would make a little more sense if reboot was grouped with start and stop, with destroy requiring some extra security role. But as it stands now, it just complicates things.</p>
<p>For reference, those actions in Digital Ocean’s new RESTful API require a POST call at <a href="https://api.digitalocean.com/v2/droplets/droplet_id/actions">https://api.digitalocean.com/v2/droplets/droplet_id/actions</a> with a request body of:</p>
<pre><code>{
 "type": "power_on"
}
</code></pre>
<p>to start a VM, or with:</p>
<pre><code>{
 "type": "reboot"
}</code></pre>
<p>to reboot a VM.</p>
<p><strong>Deploying SSH keys on new VMs</strong></p>
<p>One of the most common scenarios when creating a non-windows virtual machine, is for the provider to deploy it with your public SSH key already in place. That usually means calling “deploy VM” with at least one extra input, your public key. This is also the case when you create a new VM from Azure’s portal. But for some reason, the API call <a href="http://msdn.microsoft.com/library/azure/jj157194.aspx#SSH">requires you to upload your private key too</a>. This is obviously unacceptable for many production environments.</p>
<p><strong>Conclusion</strong></p>
<p>While we were pleasantly surprised by Azure itself and the way Microsoft is upping its game as a Cloud provider, the Azure API still needs a lot of love to be on par with the rest of the service. While it works for most MS technologies, trying to do anything else with it (like deploying a Linux VM) is too much of a challenge. Using JSON alongside XML for requests and responses, would reduce complexity for those that are used to working with other APIs. Furthermore, the API is not RESTful and the requests are far too complicated to remember, forcing you to constantly check the documentation.</p>
<p><strong>Are you using Microsoft Azure? Mist.io can help you manage and monitor your virtual machines from anywhere. <a href="https://mist.io">Try it for free</a>.</strong></p>
